<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Pomodoro с дождём и Lo-Fi</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        background: black;
        font-family: sans-serif;
        color: white;
    }
    video {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        object-fit: cover;
        z-index: -2;
    }
    canvas {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
        z-index: -1;
    }
    .controls {
        position: fixed;
        top: 10px; left: 10px;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 8px;
    }
    .controls label {
        display: block;
        margin-top: 5px;
    }
    button {
        margin-top: 5px;
        padding: 5px 10px;
        background: #444;
        border: none;
        color: white;
        cursor: pointer;
    }
    button:hover {
        background: #666;
    }
</style>
</head>
<body>

<video autoplay muted loop playsinline id="bgVideo">
    <source src="forest.mp4" type="video/mp4">
</video>
<canvas id="raindrops"></canvas>

<div class="controls">
    <button id="muteBtn">Mute</button>
    <label>Громкость дождя: <input type="range" id="rainVolume" min="0" max="1" step="0.01" value="0.5"></label>
    <label>Громкость Lo-Fi: <input type="range" id="lofiVolume" min="0" max="1" step="0.01" value="0.5"></label>
    <button id="toggleLofi">Вкл/Выкл Lo-Fi</button>
</div>

<audio id="rainAudio" src="rain_sound.mp3" autoplay loop></audio>
<audio id="lofiAudio" src="https://stream.lofi.cafe/lofi" loop></audio>

<script>
const canvas = document.getElementById('raindrops');
const ctx = canvas.getContext('2d');
let drops = [];

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Drop {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = 0;
        this.length = canvas.height; // след до конца экрана
        this.speed = 0.2 + Math.random() * 0.3;
        this.radius = 8 + Math.random() * 6;
        this.opacity = 1;
    }
    update() {
        this.y += this.speed;
        if (this.y > canvas.height + this.radius) {
            this.reset();
        }
    }
    reset() {
        this.x = Math.random() * canvas.width;
        this.y = -this.radius;
        this.speed = 0.2 + Math.random() * 0.3;
        this.radius = 8 + Math.random() * 6;
    }
    draw() {
        const grd = ctx.createRadialGradient(this.x, this.y, this.radius * 0.3, this.x, this.y, this.radius);
        grd.addColorStop(0, 'rgba(255,255,255,0.6)');
        grd.addColorStop(0.5, 'rgba(255,255,255,0.2)');
        grd.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = grd;

        ctx.beginPath();
        ctx.moveTo(this.x, this.y - this.radius * 1.5); // форма слезы
        ctx.bezierCurveTo(this.x - this.radius, this.y, this.x - this.radius, this.y + this.radius * 1.5, this.x, this.y + this.radius * 1.5);
        ctx.bezierCurveTo(this.x + this.radius, this.y + this.radius * 1.5, this.x + this.radius, this.y, this.x, this.y - this.radius * 1.5);
        ctx.closePath();
        ctx.fill();

        const trailGrad = ctx.createLinearGradient(this.x, this.y - this.length, this.x, this.y);
        trailGrad.addColorStop(0, 'rgba(255,255,255,0)');
        trailGrad.addColorStop(1, 'rgba(255,255,255,0.15)');
        ctx.fillStyle = trailGrad;
        ctx.fillRect(this.x - this.radius / 4, this.y - this.length, this.radius / 2, this.length);
    }
}

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drops.forEach(d => {
        d.update();
        d.draw();
    });
    requestAnimationFrame(animate);
}

for (let i = 0; i < 20; i++) {
    drops.push(new Drop());
}
animate();

// --- ЗВУК ---
const rainAudio = document.getElementById('rainAudio');
const lofiAudio = document.getElementById('lofiAudio');
rainAudio.volume = 0.5;
lofiAudio.volume = 0.5;

document.getElementById('rainVolume').addEventListener('input', e => {
    rainAudio.volume = e.target.value;
});
document.getElementById('lofiVolume').addEventListener('input', e => {
    lofiAudio.volume = e.target.value;
});

document.getElementById('muteBtn').addEventListener('click', () => {
    const isMuted = rainAudio.muted;
    rainAudio.muted = !isMuted;
    lofiAudio.muted = !isMuted;
});

document.getElementById('toggleLofi').addEventListener('click', () => {
    if (lofiAudio.paused) {
        lofiAudio.play();
    } else {
        lofiAudio.pause();
    }
});
</script>

</body>
</html>
