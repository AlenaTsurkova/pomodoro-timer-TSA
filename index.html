<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LoFi Pomodoro</title>
<style>
  :root {
    --panel-bg: rgba(0,0,0,.45);
    --panel-br: 12px;
    --text: #fff;
    --muted: #cfd8dc;
    --accent: #81c784;
    --danger: #ef9a9a;
  }
  html, body {
    margin:0; padding:0; height:100%; overflow:hidden;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color: var(--text);
    background:#000;
  }
  /* –§–û–ù */
  #bgVideo {
    position:fixed; inset:0;
    width:100%; height:100%;
    object-fit:cover;
    z-index:-1;
  }

  /* –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø (–∫–∞–∫ —Ä–∞–Ω—å—à–µ: —Å–Ω–∏–∑—É —Å–ª–µ–≤–∞) */
  .controls {
    position:fixed; left:20px; bottom:20px;
    display:flex; flex-direction:column; gap:8px;
    background:var(--panel-bg); backdrop-filter: blur(6px);
    padding:12px 14px; border-radius:var(--panel-br);
    max-width:min(92vw, 520px);
  }
  .row {
    display:flex; flex-wrap:wrap; gap:8px; align-items:center;
  }
  .grow { flex:1 1 auto; }
  .label { font-size:12px; color:var(--muted); margin-right:6px; }
  .pill {
    border:1px solid rgba(255,255,255,.28);
    background:rgba(255,255,255,.08);
    color:#fff; border-radius:999px; padding:6px 10px;
    font-size:14px; cursor:pointer; user-select:none;
  }
  .pill:hover { background:rgba(255,255,255,.18); }
  .pill.accent { border-color:rgba(129,199,132,.6); }
  .pill.danger { border-color:rgba(239,154,154,.6); }
  .pill.small { font-size:13px; padding:4px 10px; }
  .pill.toggle[aria-pressed="true"] { background:rgba(129,199,132,.22); }

  input[type="number"] {
    width:72px; padding:6px 8px; border-radius:10px;
    border:1px solid rgba(255,255,255,.28);
    background:rgba(255,255,255,.08); color:#fff; outline:none;
    font-size:14px;
  }
  input[type="range"]{
    width:160px;
  }
  #modeBadge{
    font-weight:700; letter-spacing:.3px;
    padding:6px 10px; border-radius:999px; font-size:13px;
    background:rgba(129,199,132,.22); border:1px solid rgba(129,199,132,.5);
  }
  #modeBadge.break {
    background:rgba(239,154,154,.18); border-color:rgba(239,154,154,.55);
  }
  #timeDisplay {
    font-variant-numeric:tabular-nums;
    font-size:24px; font-weight:800; letter-spacing:.5px;
    padding:3px 8px;
  }
  .spacer { flex:1 1 auto; }
  .hint { font-size:12px; color:var(--muted); }
</style>
</head>
<body>

<!-- –§–û–ù-–í–ò–î–ï–û -->
<video id="bgVideo" autoplay muted loop playsinline>
  <source src="background.mp4" type="video/mp4"/>
</video>

<!-- –ê—É–¥–∏–æ (Lo-Fi –ø–æ—Ç–æ–∫) -->
<audio id="lofi" preload="none">
  <!-- –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ -->
  <source src="https://listen.myrh.ru/id7115" type="audio/mpeg"/>
</audio>

<!-- –ü–ê–ù–ï–õ–¨ -->
<div class="controls" role="region" aria-label="–ü–∞–Ω–µ–ª—å Pomodoro">
  <!-- –†—è–¥ 1: –†–µ–∂–∏–º + –í—Ä–µ–º—è + –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞ + –°–±—Ä–æ—Å -->
  <div class="row">
    <span id="modeBadge">–†–∞–±–æ—Ç–∞</span>
    <div id="timeDisplay" class="grow" aria-live="polite">25:00</div>
    <button id="startPause" class="pill accent">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
    <button id="resetBtn" class="pill danger">‚ü≤ –°–±—Ä–æ—Å</button>
  </div>

  <!-- –†—è–¥ 2: –ø—Ä–µ—Å–µ—Ç—ã –†–∞–±–æ—Ç—ã + —Å–≤–æ—ë -->
  <div class="row">
    <span class="label">–†–∞–±–æ—Ç–∞:</span>
    <button class="pill small preset-work" data-min="25">25 –º–∏–Ω</button>
    <button class="pill small preset-work" data-min="30">30 –º–∏–Ω</button>
    <button class="pill small preset-work" data-min="45">45 –º–∏–Ω</button>
    <span class="spacer"></span>
    <span class="label">–°–≤–æ–∏ (–º–∏–Ω):</span>
    <input id="customWork" type="number" min="1" step="1" value="25" />
    <button id="applyWork" class="pill small">OK</button>
  </div>

  <!-- –†—è–¥ 3: –ø—Ä–µ—Å–µ—Ç—ã –ü–µ—Ä–µ—Ä—ã–≤–∞ + —Å–≤–æ—ë -->
  <div class="row">
    <span class="label">–ü–µ—Ä–µ—Ä—ã–≤:</span>
    <button class="pill small preset-break" data-min="5">5 –º–∏–Ω</button>
    <button class="pill small preset-break" data-min="10">10 –º–∏–Ω</button>
    <button class="pill small preset-break" data-min="15">15 –º–∏–Ω</button>
    <span class="spacer"></span>
    <span class="label">–°–≤–æ–∏ (–º–∏–Ω):</span>
    <input id="customBreak" type="number" min="1" step="1" value="5" />
    <button id="applyBreak" class="pill small">OK</button>
  </div>

  <!-- –†—è–¥ 4: –ó–≤—É–∫: mute, –≥—Ä–æ–º–∫–æ—Å—Ç—å, –∫–æ–ª–æ–∫–æ–ª, —Ü–∏–∫–ª -->
  <div class="row">
    <button id="muteBtn" class="pill toggle" aria-pressed="false">üîä Mute</button>
    <span class="label">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</span>
    <input id="volume" type="range" min="0" max="1" step="0.01" value="0.6"/>
    <button id="bellBtn" class="pill toggle" aria-pressed="true" title="–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏">üîî</button>
    <button id="loopBtn" class="pill toggle" aria-pressed="true" title="–ê–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥ –†–∞–±–æ—Ç–∞‚Üî–ü–µ—Ä–µ—Ä—ã–≤">üîÅ –¶–∏–∫–ª</button>
    <span class="spacer"></span>
    <span class="hint">–ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ¬´–°—Ç–∞—Ä—Ç¬ª (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞).</span>
  </div>
</div>

<script>
/* ======= –≠–õ–ï–ú–ï–ù–¢–´ ======= */
const audio = document.getElementById('lofi');
const volume = document.getElementById('volume');
const muteBtn = document.getElementById('muteBtn');
const bellBtn = document.getElementById('bellBtn');
const loopBtn = document.getElementById('loopBtn');

const modeBadge = document.getElementById('modeBadge');
const timeDisplay = document.getElementById('timeDisplay');
const startPause = document.getElementById('startPause');
const resetBtn = document.getElementById('resetBtn');

const presetWorkBtns = document.querySelectorAll('.preset-work');
const presetBreakBtns = document.querySelectorAll('.preset-break');
const customWork = document.getElementById('customWork');
const applyWork = document.getElementById('applyWork');
const customBreak = document.getElementById('customBreak');
const applyBreak = document.getElementById('applyBreak');

/* ======= –°–û–°–¢–û–Ø–ù–ò–ï –¢–ê–ô–ú–ï–†–ê ======= */
let mode = 'work';            // 'work' | 'break'
let workMinutes = 25;         // –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
let breakMinutes = 5;         // –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–∞
let remaining = workMinutes * 60;  // —Å–µ–∫—É–Ω–¥—ã
let running = false;
let intervalId = null;

/* ======= –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ======= */
function fmt(sec){
  const m = Math.floor(sec/60).toString().padStart(2,'0');
  const s = (sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}
function setMode(newMode){
  mode = newMode;
  if(mode==='work'){
    remaining = workMinutes * 60;
    modeBadge.textContent = '–†–∞–±–æ—Ç–∞';
    modeBadge.classList.remove('break');
  } else {
    remaining = breakMinutes * 60;
    modeBadge.textContent = '–ü–µ—Ä–µ—Ä—ã–≤';
    modeBadge.classList.add('break');
  }
  timeDisplay.textContent = fmt(remaining);
}
function tick(){
  if(remaining>0){
    remaining--;
    timeDisplay.textContent = fmt(remaining);
    return;
  }
  // –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
  stopTimer(false);
  if(bellBtn.getAttribute('aria-pressed')==='true'){ chime(); }
  // –∞–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥
  if(loopBtn.getAttribute('aria-pressed')==='true'){
    setMode(mode==='work' ? 'break' : 'work');
    startTimer(); // –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã
  }
}

/* ======= –¢–ê–ô–ú–ï–† ======= */
function startTimer(){
  if(running) return;
  running = true;
  startPause.textContent = '‚è∏ –ü–∞—É–∑–∞';
  // –∑–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –ø–æ –∂–µ—Å—Ç—É
  if(audio.paused){ audio.play().catch(()=>{}); }
  intervalId = setInterval(tick, 1000);
}
function pauseTimer(){
  running = false;
  startPause.textContent = '‚ñ∂ –°—Ç–∞—Ä—Ç';
  clearInterval(intervalId);
  intervalId = null;
}
function stopTimer(resetPhase=true){
  running = false;
  startPause.textContent = '‚ñ∂ –°—Ç–∞—Ä—Ç';
  clearInterval(intervalId);
  intervalId = null;
  if(resetPhase){
    setMode(mode); // —Å–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã –∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
  }
}

/* ======= –°–ò–ì–ù–ê–õ (WebAudio –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–æ–Ω) ======= */
let audioCtx = null;
function chime(){
  try{
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = 880;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.value = 0.0001;
    o.start();
    // –ø–ª–∞–≤–Ω–∞—è –æ–≥–∏–±–∞—é—â–∞—è
    g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.6);
    o.stop(audioCtx.currentTime + 0.65);
  }catch(e){}
}

/* ======= –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ======= */
startPause.addEventListener('click', () => {
  if(running) pauseTimer(); else startTimer();
});

resetBtn.addEventListener('click', () => {
  stopTimer(true);
});

presetWorkBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    workMinutes = parseInt(btn.dataset.min,10);
    if(mode==='work' && !running){ setMode('work'); }
  });
});
applyWork.addEventListener('click', ()=>{
  const v = Math.max(1, parseInt(customWork.value||'25',10));
  workMinutes = v;
  if(mode==='work' && !running){ setMode('work'); }
});

presetBreakBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    breakMinutes = parseInt(btn.dataset.min,10);
    if(mode==='break' && !running){ setMode('break'); }
  });
});
applyBreak.addEventListener('click', ()=>{
  const v = Math.max(1, parseInt(customBreak.value||'5',10));
  breakMinutes = v;
  if(mode==='break' && !running){ setMode('break'); }
});

volume.addEventListener('input', e => {
  audio.volume = parseFloat(e.target.value);
});

muteBtn.addEventListener('click', ()=>{
  const pressed = muteBtn.getAttribute('aria-pressed')==='true';
  const next = !pressed;
  muteBtn.setAttribute('aria-pressed', String(next));
  audio.muted = next;
  muteBtn.textContent = next ? 'üîá Unmute' : 'üîä Mute';
});

bellBtn.addEventListener('click', ()=>{
  const pressed = bellBtn.getAttribute('aria-pressed')==='true';
  bellBtn.setAttribute('aria-pressed', String(!pressed));
});

loopBtn.addEventListener('click', ()=>{
  const pressed = loopBtn.getAttribute('aria-pressed')==='true';
  loopBtn.setAttribute('aria-pressed', String(!pressed));
});

/* ======= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======= */
audio.volume = parseFloat(volume.value);
audio.loop = true;  // –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
setMode('work');    // —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
</script>
</body>
</html>
