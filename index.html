<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Pomodoro Rain LoFi</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: black;
    }
    video {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
    }
    canvas {
        position: fixed;
        top: 0;
        left: 0;
        z-index: -1;
    }
    .controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        background: rgba(0,0,0,0.5);
        padding: 10px 15px;
        border-radius: 12px;
    }
    button, input[type=range] {
        background: rgba(255,255,255,0.1);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
    }
    button:hover {
        background: rgba(255,255,255,0.25);
    }
</style>
</head>
<body>

<video autoplay muted loop id="bgVideo">
    <source src="background.mp4" type="video/mp4">
</video>
<canvas id="rainCanvas"></canvas>

<div class="controls">
    <button id="pomodoroBtn">‚ñ∂Ô∏è Pomodoro</button>
    <button id="muteBtn">üîá Mute</button>
    <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.5">
</div>

<audio id="rainAudio" src="rain_sound.mp3" loop></audio>
<audio id="lofiAudio" crossorigin="anonymous"></audio>

<!-- LoFi Radio embed -->
<div style="display:none">
    <div class="RP-SCRIPT">
        <a class="RP-LINK" href="https://radiopotok.ru/lofiradio">LoFi –†–∞–¥–∏–æ</a>
    </div>
    <script defer src="https://radiopotok.ru/f/script6.1/2311.js" charset="UTF-8"></script>
</div>

<script>
const canvas = document.getElementById('rainCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

class Drop {
    constructor() {
        this.reset();
    }
    reset() {
        this.x = Math.random() * canvas.width;
        this.y = -20;
        this.len = 25 + Math.random() * 15;
        this.speed = 0.3 + Math.random() * 0.2;
        this.alpha = 1;
    }
    draw() {
        const grd = ctx.createLinearGradient(this.x, this.y, this.x, this.y + this.len);
        grd.addColorStop(0, 'rgba(255,255,255,0.3)');
        grd.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.quadraticCurveTo(this.x+2, this.y + this.len/2, this.x, this.y + this.len);
        ctx.closePath();
        ctx.fill();
    }
    update() {
        this.y += this.speed;
        if (this.y > canvas.height) this.reset();
    }
}
let drops = [];
for (let i = 0; i < 50; i++) drops.push(new Drop());

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drops.forEach(d => { d.update(); d.draw(); });
    requestAnimationFrame(animate);
}
animate();

// AUDIO
const rainAudio = document.getElementById('rainAudio');
const lofiAudio = document.getElementById('lofiAudio');
lofiAudio.src = "https://listen.myrh.ru/id7115"; // –ü–æ—Ç–æ–∫ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å

let isMuted = false;
let isWork = false;

document.getElementById('pomodoroBtn').addEventListener('click', () => {
    isWork = !isWork;
    if (isWork) {
        rainAudio.play();
        lofiAudio.play();
        document.getElementById('pomodoroBtn').textContent = "‚è∏Ô∏è –û—Ç–¥—ã—Ö";
    } else {
        rainAudio.play();
        lofiAudio.pause();
        document.getElementById('pomodoroBtn').textContent = "‚ñ∂Ô∏è Pomodoro";
    }
});

document.getElementById('muteBtn').addEventListener('click', () => {
    isMuted = !isMuted;
    rainAudio.muted = isMuted;
    lofiAudio.muted = isMuted;
    document.getElementById('muteBtn').textContent = isMuted ? "üîà Unmute" : "üîá Mute";
});

document.getElementById('volumeControl').addEventListener('input', (e) => {
    rainAudio.volume = e.target.value;
    lofiAudio.volume = e.target.value;
});

rainAudio.volume = 0.5;
lofiAudio.volume = 0.5;
rainAudio.play().catch(()=>{});
</script>

</body>
</html>
